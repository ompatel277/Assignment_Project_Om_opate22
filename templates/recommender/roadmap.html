{% extends "accounts/base.html" %}
{% load static %}

{% block title %}My Roadmap — Traject{% endblock %}

{% block content %}
<div class="container mt-5">

 <!-- Header -->
 <div class="row mb-4">
 <div class="col-12">
 <div class="card bg-gradient text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
 <div class="card-body p-4">
 <h1 class="display-5 fw-bold mb-2">
 <i class="bi bi-map-fill"></i> My College Roadmap
 </h1>
 <p class="lead mb-0">Your personalized semester-by-semester plan to graduation</p>
 </div>
 </div>
 </div>
 </div>

 <!-- Plan Selection and Comparison Controls -->
 {% if career_plans %}
 <div class="row mb-4">
 <div class="col-md-8">
 <div class="card shadow-sm">
 <div class="card-body">
 <div class="row align-items-center">
 <div class="col-md-8">
 <label class="form-label fw-bold mb-2"><i class="bi bi-diagram-3"></i> Select Career Plan:</label>
 <select class="form-select" id="planSelector" onchange="window.location.href='?plan=' + this.value">
 <option value="">-- Select a Plan --</option>
 {% for plan in career_plans %}
 <option value="{{ plan.id }}" {% if selected_plan and selected_plan.id == plan.id %}selected{% endif %}>
 {{ plan.name }} ({{ plan.target_career.title }})
 {% if plan.is_primary %}★ Primary{% endif %}
 </option>
 {% endfor %}
 </select>
 </div>
 <div class="col-md-4 text-end">
 {% if not compare_mode %}
 <a href="?compare=true" class="btn btn-primary">
 <i class="bi bi-layout-split"></i> Compare Plans
 </a>
 {% else %}
 <a href="{% url 'recommender:roadmap' %}" class="btn btn-outline-primary">
 <i class="bi bi-eye"></i> Single View
 </a>
 {% endif %}
 </div>
 </div>
 </div>
 </div>
 </div>
 <div class="col-md-4">
 {% if selected_plan and not compare_mode %}
 <div class="card border-primary shadow-sm h-100">
 <div class="card-body">
 <h6 class="text-primary mb-2"><i class="bi bi-briefcase"></i> Current Plan</h6>
 <p class="fw-bold mb-1">{{ selected_plan.name }}</p>
 <small class="text-muted">{{ selected_plan.target_career.title }}</small>
 </div>
 </div>
 {% endif %}
 </div>
 </div>
 {% endif %}

 {% if compare_mode %}
 <!-- COMPARISON MODE: Show multiple roadmaps side by side -->
 <div class="row">
 {% for data in roadmaps_data %}
 <div class="col-md-6 mb-4">
 <div class="card h-100 border-primary shadow">
 <div class="card-header bg-primary text-white">
 <h4 class="mb-0">
 <i class="bi bi-diagram-3"></i> {{ data.plan.name }}
 {% if data.plan.is_primary %}
 <span class="badge bg-success ms-2">Primary</span>
 {% endif %}
 </h4>
 <small>Target: {{ data.plan.target_career.title }}</small>
 </div>
 <div class="card-body">
 <!-- Summary Stats for this plan -->
 <div class="row g-2 mb-3">
 <div class="col-6">
 <div class="card text-center border-primary">
 <div class="card-body p-2">
 <h6 class="text-accent mb-0">{{ data.summary.total_semesters }}</h6>
 <small class="text-muted">Semesters</small>
 </div>
 </div>
 </div>
 <div class="col-6">
 <div class="card text-center border-success">
 <div class="card-body p-2">
 <h6 class="text-success mb-0">{{ data.summary.total_courses }}</h6>
 <small class="text-muted">Courses</small>
 </div>
 </div>
 </div>
 <div class="col-6">
 <div class="card text-center border-info">
 <div class="card-body p-2">
 <h6 class="text-info mb-0">{{ data.summary.total_credits|floatformat:0 }}</h6>
 <small class="text-muted">Credits</small>
 </div>
 </div>
 </div>
 <div class="col-6">
 <div class="card text-center border-warning">
 <div class="card-body p-2">
 <h6 class="text-warning mb-0">{{ data.summary.graduation_season|slice:":3" }} '{{ data.summary.graduation_year|slice:"-2:" }}</h6>
 <small class="text-muted">Graduation</small>
 </div>
 </div>
 </div>
 </div>

 <a href="?plan={{ data.plan.id }}" class="btn btn-sm btn-primary w-100">
 <i class="bi bi-eye"></i> View Full Roadmap
 </a>
 </div>
 </div>
 </div>
 {% endfor %}
 </div>

 {% else %}
 <!-- SINGLE MODE: Show detailed roadmap -->

 <!-- Summary Stats -->
 <div class="row g-3 mb-5">
 <div class="col-md-3">
 <div class="card text-center border-primary h-100">
 <div class="card-body">
 <h3 class="text-accent mb-0">{{ summary.total_semesters }}</h3>
 <small class="text-muted">Semesters</small>
 </div>
 </div>
 </div>
 <div class="col-md-3">
 <div class="card text-center border-success h-100">
 <div class="card-body">
 <h3 class="text-success mb-0">{{ summary.total_courses }}</h3>
 <small class="text-muted">Courses</small>
 </div>
 </div>
 </div>
 <div class="col-md-3">
 <div class="card text-center border-info h-100">
 <div class="card-body">
 <h3 class="text-info mb-0">{{ summary.total_credits|floatformat:0 }}</h3>
 <small class="text-muted">Credits</small>
 </div>
 </div>
 </div>
 <div class="col-md-3">
 <div class="card text-center border-warning h-100">
 <div class="card-body">
 <h3 class="text-warning mb-0">{{ summary.graduation_season }} {{ summary.graduation_year }}</h3>
 <small class="text-muted">Graduation</small>
 </div>
 </div>
 </div>
 </div>

 <!-- Navigation -->
 <div class="mb-4">
 <a href="{% url 'accounts:dashboard' %}" class="btn btn-outline-secondary">← Back to Dashboard</a>
 </div>

 <!-- Semester Plans -->
 {% for semester in roadmap %}
 <div class="card mb-4 shadow-sm border-primary">
 <div class="card-header bg-primary text-white">
 <h4 class="mb-0">
 <i class="bi bi-calendar3"></i> Semester {{ semester.semester_number }}: {{ semester.season }} {{ semester.year }}
 </h4>
 </div>
 <div class="card-body">

 <!-- Courses -->
 <div class="mb-4">
 <h5 class="text-success mb-3"><i class="bi bi-book-fill"></i> Courses ({{ semester.total_credits|floatformat:1 }} credits)</h5>
 {% if semester.courses %}
 <div class="row g-2">
 {% for course_data in semester.courses %}
 <div class="col-md-6">
 <div class="card h-100 border-success">
 <div class="card-body p-3">
 <h6 class="mb-1">{{ course_data.course.subject }} {{ course_data.course.number }}</h6>
 <p class="small mb-1">{{ course_data.course.title }}</p>
 <span class="badge bg-success small">{{ course_data.credits }} credits</span>
 </div>
 </div>
 </div>
 {% endfor %}
 </div>
 {% else %}
 <p class="text-muted small">No courses scheduled for this semester.</p>
 {% endif %}
 </div>

 <!-- Portfolio Items -->
 <div class="mb-4">
 <h5 class="text-info mb-3"><i class="bi bi-folder2"></i> Portfolio Goals</h5>
 {% if semester.portfolio_items %}
 <div class="list-group list-group-flush">
 {% for item_data in semester.portfolio_items %}
 <div class="list-group-item">
 <div class="d-flex justify-content-between align-items-start">
 <div>
 <span class="badge bg-info">{{ item_data.item.get_item_type_display }}</span>
 <strong>{{ item_data.item.title }}</strong>
 {% if item_data.estimated_hours %}
 <span class="badge bg-secondary ms-2">~{{ item_data.estimated_hours }}h</span>
 {% endif %}
 <br>
 <small class="text-muted">{{ item_data.reasoning }}</small>
 </div>
 </div>
 </div>
 {% endfor %}
 </div>
 {% else %}
 <p class="text-muted small">No portfolio items for this semester.</p>
 {% endif %}
 </div>

 <!-- Clubs -->
 {% if semester.clubs %}
 <div class="mb-4">
 <h5 class="text-warning mb-3"><i class="bi bi-people-fill"></i> Clubs & Organizations</h5>
 <div class="d-flex gap-2 flex-wrap">
 {% for club in semester.clubs %}
 <span class="badge bg-warning text-dark">{{ club }}</span>
 {% endfor %}
 </div>
 </div>
 {% endif %}

 <!-- Milestones -->
 <div>
 <h5 class="text-primary mb-3"><i class="bi bi-bullseye"></i> Career Milestones</h5>
 {% if semester.milestones %}
 <ul class="mb-0">
 {% for milestone in semester.milestones %}
 <li>{{ milestone }}</li>
 {% endfor %}
 </ul>
 {% else %}
 <p class="text-muted small mb-0">No specific milestones for this semester.</p>
 {% endif %}
 </div>

 </div>
 </div>
 {% empty %}
 <div class="card shadow-sm">
 <div class="card-body text-center py-5">
 <i class="bi bi-map fs-1 text-muted mb-3 d-block"></i>
 <h4 class="mb-3">No Roadmap Available</h4>
 <p class="text-muted">Make sure you have a major selected in your profile to generate your personalized roadmap.</p>
 <a href="{% url 'accounts:edit_profile' %}" class="btn btn-primary">
 <i class="bi bi-pencil"></i> Update Profile
 </a>
 </div>
 </div>
 {% endfor %}

 {% endif %}
 <!-- End of compare_mode conditional -->

</div>
{% endblock %}