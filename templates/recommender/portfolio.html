{% extends "accounts/base.html" %}
{% load static %}

{% block title %}Portfolio Recommendations - Traject{% endblock %}

{% block content %}
<div class="container">
 <div class="row mb-4">
 <div class="col-12">
 <h1 class="display-5"><i class="bi bi-list-check"></i> Recommended Portfolio Items</h1>
 <p class="lead text-muted">Build your portfolio with these curated activities and achievements</p>
 </div>
 </div>

 <!-- Filter by Category -->
 <div class="row mb-4">
 <div class="col-12">
 <div class="btn-group" role="group">
 <a href="?category=all" class="btn btn-outline-primary {% if not request.GET.category or request.GET.category == 'all' %}active{% endif %}">All</a>
 <a href="?category=PROJECT" class="btn btn-outline-primary {% if request.GET.category == 'PROJECT' %}active{% endif %}">Projects</a>
 <a href="?category=COURSE" class="btn btn-outline-primary {% if request.GET.category == 'COURSE' %}active{% endif %}">Courses</a>
 <a href="?category=CERTIFICATION" class="btn btn-outline-primary {% if request.GET.category == 'CERTIFICATION' %}active{% endif %}">Certifications</a>
 <a href="?category=EXPERIENCE" class="btn btn-outline-primary {% if request.GET.category == 'EXPERIENCE' %}active{% endif %}">Experience</a>
 <a href="?category=ACHIEVEMENT" class="btn btn-outline-primary {% if request.GET.category == 'ACHIEVEMENT' %}active{% endif %}">Achievements</a>
 </div>
 </div>
 </div>

 {% if recommendations %}
 <div class="row">
 {% for rec in recommendations %}
 {% with item=rec.item %}
 <div class="col-md-6 col-lg-4 mb-4">
 <div class="card h-100 shadow-sm border-{{ item.item_type|lower }}">
 <div class="card-header bg-{{ item.item_type|lower }} text-white">
 <div class="d-flex justify-content-between align-items-center">
 <span class="badge bg-light text-dark">{{ item.get_item_type_display }}</span>
 <span class="badge bg-success">{{ rec.relevance_score }}% Match</span>
 </div>
 </div>
 <div class="card-body">
 <h5 class="card-title">{{ item.title }}</h5>
 <p class="card-text small">{{ item.description|truncatewords:15 }}</p>

 <div class="mb-2">
 <span class="badge bg-secondary">{{ item.get_difficulty_level_display }}</span>
 {% if item.estimated_hours %}
 <span class="badge bg-info">~{{ item.estimated_hours }}h</span>
 {% endif %}
 </div>

 <div class="mb-3">
 <small class="text-muted"><strong>Why recommended:</strong></small>
 <p class="small mb-0">{{ rec.reasoning|truncatewords:15 }}</p>
 </div>

 <div class="d-grid">
 <form method="post" action="{% url 'accounts:add_portfolio_to_checklist' item.id %}">
 {% csrf_token %}
 <button type="submit" class="btn btn-sm btn-primary w-100">
 <i class="bi bi-plus-circle"></i> Add to My Portfolio
 </button>
 </form>
 </div>
 </div>
 </div>
 </div>
 {% endwith %}
 {% endfor %}
 </div>
 {% else %}
 <div class="card shadow-sm">
 <div class="card-body text-center py-5">
 <i class="bi bi-list-check fs-1 text-muted mb-3 d-block"></i>
 <h4 class="mb-3">No Portfolio Recommendations Yet</h4>
 <p class="text-muted">Complete your profile to get personalized portfolio recommendations!</p>
 <a href="{% url 'accounts:edit_profile' %}" class="btn btn-primary">
 <i class="bi bi-pencil"></i> Update Profile
 </a>
 </div>
 </div>
 {% endif %}

 <!-- Pagination if needed -->
 {% if is_paginated %}
 <nav>
 <ul class="pagination justify-content-center">
 {% if page_obj.has_previous %}
 <li class="page-item"><a class="page-link" href="?page=1">First</a></li>
 <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a></li>
 {% endif %}

 <li class="page-item active"><span class="page-link">{{ page_obj.number }}</span></li>

 {% if page_obj.has_next %}
 <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a></li>
 <li class="page-item"><a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">Last</a></li>
 {% endif %}
 </ul>
 </nav>
 {% endif %}
</div>
{% endblock %}